# COLMAP 动态相机轨迹可视化

该工具用于在交互式 3D 界面中可视化 **COLMAP** 重建结果，包括相机位姿和三维点云，并支持相机轨迹的动态播放。
你可以选择在播放过程中逐步显示相机视椎体（累积模式，默认开启），或者一次性显示所有相机。

## 功能特性

* 解析 **COLMAP** 模型文件：`cameras.txt`, `images.txt`, `points3D.txt`

  * 如果输入目录中只有 `.bin` 文件，脚本会自动调用 `colmap model_converter` 转换生成 `.txt` 文件
* 动态播放相机轨迹
* 可选逐步显示相机（视椎体、坐标轴、相机中心）
* 可视化点云（支持对大规模数据集随机下采样）
* 按 **image\_id** 或 **文件名顺序** 排序轨迹
* 支持交互式键盘控制

## 安装

```bash
pip install open3d numpy
```

如果需要自动从 `.bin` 转换为 `.txt`，请确保 `colmap` 已正确安装并加入 PATH。

## 使用方法

```bash
python main.py -m /path/to/sparse/0 [选项]
```

### 主要参数

* `-m, --model` : COLMAP 模型路径（通常为 `sparse/0`）
* `-f, --fps` : 播放帧率（默认 `5`）
* `-t, --traj` : 轨迹排序方式

  * `id` → 按 `image_id` 升序
  * `name` → 按文件名自然顺序
* `-s, --scale` : 相机视椎体大小（默认 `0.1`）
* `-n, --max-points` : 渲染点数上限（默认 `200000`，超出时随机采样）
* `-C, --no-cumulative` : 禁用累积模式（默认开启累积）
* `-p, --play` : 启动后立即播放

## 键盘操作

* **空格** : 播放 / 暂停
* **n / N** : 下一帧（单步）
* **p / P** : 上一帧（单步）
* **+ / =** : 提高播放速度
* **-** : 降低播放速度
* **r / R** : 重置到第一帧（在累积模式下也会清除已显示的相机）
* **q / Q / Esc** : 退出程序

## 使用示例

```bash
# 按文件名顺序播放轨迹，逐步显示相机（默认累积模式）
python main.py -m ./sparse/0 -t name -p

# 一次性显示所有相机，帧率设为 8 FPS
python main.py -m ./sparse/0 -f 8 -C
```

---

## 注意事项

* 大规模点云加载可能较慢，可以通过减小 `-n` 加快速度
* 在默认累积模式下，播放过的相机会保持显示，直到重置或退出
* 扩展功能：如果需要在视椎体上渲染原始图像，需要额外提供图像路径
